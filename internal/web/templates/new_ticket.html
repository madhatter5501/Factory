{{define "new_ticket.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Ticket | Factory</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/htmx.min.js"></script>
</head>
<body hx-ext="sse" sse-connect="/api/events">
    <!-- Global Status Bar -->
    {{template "global_status" .}}

    <!-- Mobile Header -->
    <header class="mobile-header">
        <div class="logo">
            <span class="logo-icon">{{icon "activity"}}</span>
            <span class="logo-text">Factory</span>
        </div>
        <button class="hamburger" onclick="toggleSidebar()" aria-label="Toggle menu">{{icon "layers"}}</button>
    </header>
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div class="app">
        <nav class="sidebar">
            <div class="logo">
                <span class="logo-icon">{{icon "activity"}}</span>
                <span class="logo-text">Factory</span>
            </div>
            <ul class="nav-links">
                <li><a href="/">
                    <span class="nav-icon">{{icon "layout"}}</span>
                    <span class="nav-content">
                        <span class="nav-label">Execution</span>
                        <span class="nav-contract">Work items & flow</span>
                    </span>
                </a></li>
                <li><a href="/agents">
                    <span class="nav-icon">{{icon "bot"}}</span>
                    <span class="nav-content">
                        <span class="nav-label">Agents</span>
                        <span class="nav-contract">Actors & capabilities</span>
                    </span>
                </a></li>
                <li><a href="/settings">
                    <span class="nav-icon">{{icon "settings"}}</span>
                    <span class="nav-content">
                        <span class="nav-label">Policies</span>
                        <span class="nav-contract">Thresholds & rules</span>
                    </span>
                </a></li>
            </ul>
            <div class="sidebar-footer">
                <a href="/new" class="btn btn-primary">{{icon "plus"}} New Ticket</a>
            </div>
        </nav>
        <main class="content">
            <div class="new-ticket-page">
                <div class="page-header">
                    <a href="/" class="back-link">{{icon "arrow-left"}} Back to Board</a>
                    <h1>Create New Ticket</h1>
                </div>

                <form class="ticket-form" hx-post="/api/tickets" hx-swap="none"
                      hx-on::after-request="if(event.detail.successful) window.location='/'">
                    <div class="form-group">
                        <label for="title">Title *</label>
                        <input type="text" id="title" name="title" required
                               placeholder="Brief description of the work">
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="4"
                                  placeholder="Detailed description of what needs to be done"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="domain">Domain</label>
                            <select id="domain" name="domain">
                                <option value="">Select domain...</option>
                                <option value="frontend">Frontend</option>
                                <option value="backend">Backend</option>
                                <option value="infra">Infrastructure</option>
                                <option value="database">Database</option>
                                <option value="shared">Shared</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="priority">Priority</label>
                            <select id="priority" name="priority">
                                <option value="0">None</option>
                                <option value="1">P1 - Critical</option>
                                <option value="2">P2 - High</option>
                                <option value="3">P3 - Medium</option>
                                <option value="4">P4 - Low</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="type">Type</label>
                            <select id="type" name="type">
                                <option value="">Select type...</option>
                                <option value="feature">Feature</option>
                                <option value="bug">Bug Fix</option>
                                <option value="refactor">Refactor</option>
                                <option value="research">Research</option>
                                <option value="docs">Documentation</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Acceptance Criteria</label>
                        <div id="criteria-list" class="criteria-inputs">
                            <div class="criteria-input">
                                <input type="text" name="criteria[]" placeholder="Criterion 1">
                                <button type="button" class="btn-remove" onclick="this.parentElement.remove()">×</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="addCriteria()">
                            + Add Criterion
                        </button>
                    </div>

                    <div class="form-actions">
                        <a href="/" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Create Ticket</button>
                    </div>
                </form>
            </div>

            <script>
            function addCriteria() {
                const list = document.getElementById('criteria-list');
                const count = list.children.length + 1;
                const div = document.createElement('div');
                div.className = 'criteria-input';
                div.innerHTML = `
                    <input type="text" name="criteria[]" placeholder="Criterion ${count}">
                    <button type="button" class="btn-remove" onclick="this.parentElement.remove()">×</button>
                `;
                list.appendChild(div);
            }
            </script>
        </main>
    </div>
    <script>
    function toggleSidebar() {
        document.querySelector('.sidebar').classList.toggle('open');
        document.querySelector('.sidebar-overlay').classList.toggle('active');
    }
    </script>
</body>
</html>
{{end}}
